Format: Fall24-October10
Language: ru
Title: dd input/output error
Slug: dd-input-output-error
Categories: techie
<p>Что делать если при копировании нормального диска с помощью dd в Linux вы получили ошибку input/output error?</p>
<p>Ситуевина очень грустная, но решаемая. Скорее всего вы имеете дело со сбойным диском, содержащим bad блоки которые уже невозможно использовать, записывать и считывать данные.</p>
<p>Обязательно проверьте такой диск с помощью S.M.A.R.T., скорее всего он покажет вам ошибки диска. Так было в моем случае, количество сбойных блоков было настолько огромным, что пришлось распрощаться со старым жестким диском и заменить его на новый SSD.</p>
<p>Проблема была в том, что на этом диске была полностью рабочая система с лицензионным софтом, который необходим в работе. Я предпринял попытку использовать partimage, для быстрого копирования данных, но вдруг обнаружил что утилита копирует лишь треть диска, далее завершается толи с segfault, толи с каким-то другим своим веселым Сишным/Сиплюсплюсным приколом.</p>
<p>Далее я попробовал скопировать данные с помощью dd, и обнаружилось что dd доходит примерно тудаже где и partimage, и потом наступает ошибка input/output error. При этом всякие веселые флажки навроде conv=noerr,skip или еще чего-то такого совершенно не помогали.</p>
<p>Зато данные на другой диск удалось скопировать без проблем с помощью утилиты GNU под названием ddrescue.</p>
<div class="hcb_wrap">
<pre class="prism line-numbers lang-bash" data-lang="Bash"><code>ddrescue /dev/sda1 /dev/sdb1</code></pre>
</div>
<p><em>После этого мои волосы стали шелковистыми, вернулась жена, дети и собака перестала кусать диван.</em></p>
<p>Большим плюсом ddrescue является наличие встроенного прогрессбара, поэтому не приходится костылять какие-то ухищрения навроде pv и всяких не особо красивых флажков dd. Также ddrescure показывает количество попыток прочитать данные; еще на вики написано что утилита обладает каким-то сверх алгоритмом для считывания поврежденных данных, оставим это на проверку людям которые любят ковыряться в исходниках, мы же не из этих да?</p>
<p><a href="https://ru.wikipedia.org/wiki/Ddrescue" target="_blank" rel="noopener">https://ru.wikipedia.org/wiki/Ddrescue</a><br />
<a href="https://www.gnu.org/software/ddrescue/ddrescue_ru.html">https://www.gnu.org/software/ddrescue/ddrescue_ru.html</a></p>